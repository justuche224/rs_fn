import{r,j as e,B as i,al as I,b as f,t as c}from"./index-D2wGeYxt.js";import{B as g}from"./badge-Lh-Dmy7I.js";import{D as S,a as D,b as K,c as P,d as Y}from"./dialog-DmJaS50R.js";import{T as H,a as G,b,c as d,d as J,e as l}from"./table-CUnS-ku8.js";import{T as _,a as q,b as y,c as v}from"./tabs-DqgyMkPp.js";import{L as U}from"./loader-circle-D1K0hxel.js";import{E as X}from"./eye-Dx2cztMx.js";import{C as A}from"./check-CI6mM0wF.js";function M(){var w,R,T;const[n,B]=r.useState([]),[x,N]=r.useState(!0),[a,t]=r.useState(null),[O,m]=r.useState(!1),[j,k]=r.useState(""),[o,u]=r.useState(null),[F,p]=r.useState(!1),h=async()=>{try{N(!0);const s=await f.get("https://api.resonantfinance.org/api/kyc",{withCredentials:!0});B(s.data.data)}catch{c.error("Failed to fetch KYC data")}finally{N(!1)}},C=async s=>{u(s),await f.put("https://api.resonantfinance.org/api/kyc/status",{kycId:s,status:"APPROVED"},{withCredentials:!0}).then(()=>{c.success("KYC document approved successfully"),h()}).catch(()=>{c.error("Failed to approve KYC document")}).finally(()=>{u(null)})},L=async(s,E)=>{if(!E.trim()){c.error("Rejection reason is required");return}u(s),await f.put("https://api.resonantfinance.org/api/kyc/status",{kycId:s,status:"REJECTED",reason:E},{withCredentials:!0}).then(()=>{c.success("KYC document rejected successfully"),h()}).catch(()=>{c.error("Failed to reject KYC document")}).finally(()=>{u(null)})},V=s=>{t(s),m(!0)},z=s=>new Date(s).toLocaleString(),$=s=>{switch(s){case"APPROVED":return e.jsx(g,{className:"bg-green-500",children:"Approved"});case"REJECTED":return e.jsx(g,{variant:"destructive",children:"Rejected"});default:return e.jsx(g,{variant:"outline",className:"bg-yellow-100 text-yellow-800",children:"Pending"})}};return r.useEffect(()=>{h()},[]),e.jsxs("div",{className:"container mx-auto py-6 md:w-[90%] lg:w-[85%] px-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"KYC Verification Dashboard"}),e.jsx(i,{onClick:h,disabled:x,className:"cursor-pointer",children:x?"Loading...":"Refresh"})]}),x?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(U,{className:"animate-spin",size:40})}):e.jsx("div",{className:"bg-sidebar rounded-lg shadow overflow-hidden",children:e.jsxs(H,{children:[e.jsx(G,{children:e.jsxs(b,{children:[e.jsx(d,{children:"User"}),e.jsx(d,{children:"Document Type"}),e.jsx(d,{children:"Status"}),e.jsx(d,{children:"Submitted On"}),e.jsx(d,{className:"text-right",children:"Actions"})]})}),e.jsx(J,{children:n.length===0?e.jsx(b,{children:e.jsx(l,{colSpan:5,className:"text-center py-8",children:"No KYC documents found"})}):n.map(s=>e.jsxs(b,{children:[e.jsx(l,{className:"font-medium",children:s.user.name||s.user.id.substring(0,8)+"..."}),e.jsx(l,{children:s.kyc.documentType.replace("_"," ")}),e.jsx(l,{children:$(s.kyc.status)}),e.jsx(l,{children:z(s.kyc.createdAt)}),e.jsx(l,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsxs(i,{className:"cursor-pointer",variant:"outline",size:"sm",onClick:()=>V(s.kyc),children:[e.jsx(X,{className:"h-4 w-4 mr-1"}),"View"]}),s.kyc.status==="PENDING"&&e.jsxs(e.Fragment,{children:[e.jsxs(i,{variant:"default",size:"sm",className:"bg-green-600 hover:bg-green-700 cursor-pointer",onClick:()=>C(s.kyc.id),disabled:o===s.kyc.id,children:[e.jsx(A,{className:"h-4 w-4 mr-1"}),"Approve"]}),e.jsxs(i,{variant:"destructive",size:"sm",className:"cursor-pointer",onClick:()=>{t(s.kyc),k(""),p(!0)},disabled:o===s.kyc.id,children:[e.jsx(I,{className:"h-4 w-4 mr-1"}),"Reject"]})]})]})})]},s.kyc.id))})]})}),e.jsx(S,{open:O,onOpenChange:s=>{m(s),s||t(null)},children:e.jsxs(D,{className:"max-w-3xl",children:[e.jsxs(K,{children:[e.jsx(P,{children:"Document Images"}),e.jsxs(Y,{children:[a==null?void 0:a.documentType.replace("_"," ")," submitted by"," ",((w=n.find(s=>s.kyc.id===(a==null?void 0:a.id)))==null?void 0:w.user.name)||(a==null?void 0:a.userId),((R=n.find(s=>s.kyc.id===(a==null?void 0:a.id)))==null?void 0:R.user.email)&&` (${(T=n.find(s=>s.kyc.id===(a==null?void 0:a.id)))==null?void 0:T.user.email})`]})]}),a&&e.jsxs(_,{defaultValue:"front",className:"w-full",children:[e.jsxs(q,{className:"grid grid-cols-3 mb-4",children:[e.jsx(y,{value:"front",children:"Front Image"}),e.jsx(y,{value:"back",children:"Back Image"}),e.jsx(y,{value:"selfie",children:"Selfie"})]}),e.jsx(v,{value:"front",className:"flex justify-center",children:e.jsx("div",{className:"border rounded-md overflow-hidden max-h-[500px]",children:e.jsx("img",{src:`https://api.resonantfinance.org/api/kyc/images/${a.frontImage}`,alt:"Front Document",className:"object-contain max-h-[400px]"})})}),e.jsx(v,{value:"back",className:"flex justify-center",children:e.jsx("div",{className:"border rounded-md overflow-hidden max-h-[500px]",children:e.jsx("img",{src:`https://api.resonantfinance.org/api/kyc/images/${a.backImage}`,alt:"Back Document",className:"object-contain max-h-[400px]"})})}),e.jsx(v,{value:"selfie",className:"flex justify-center",children:e.jsx("div",{className:"border rounded-md overflow-hidden max-h-[500px]",children:e.jsx("img",{src:`https://api.resonantfinance.org/api/kyc/images/${a.selfieImage}`,alt:"Selfie",className:"object-contain max-h-[400px]"})})})]}),(a==null?void 0:a.status)==="PENDING"&&e.jsxs("div",{className:"flex gap-2 justify-end mt-4",children:[e.jsxs(i,{variant:"default",className:"bg-green-600 hover:bg-green-700 cursor-pointer",onClick:()=>{C(a.id),m(!1)},disabled:o===a.id,children:[e.jsx(A,{className:"h-4 w-4 mr-1"}),"Approve"]}),e.jsxs(i,{className:"cursor-pointer",variant:"destructive",onClick:()=>{m(!1),p(!0)},disabled:o===a.id,children:[e.jsx(I,{className:"h-4 w-4 mr-1"}),"Reject"]})]})]})}),e.jsx(S,{open:!!a&&F,onOpenChange:s=>{s||(t(null),p(!1))},children:e.jsxs(D,{children:[e.jsxs(K,{children:[e.jsx(P,{children:"Reject KYC Document"}),e.jsx(Y,{children:"Please provide a reason for rejecting this document."})]}),e.jsx("div",{className:"grid gap-4 py-4",children:e.jsx("textarea",{className:"min-h-[100px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",placeholder:"Enter rejection reason...",value:j,onChange:s=>k(s.target.value)})}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(i,{className:"cursor-pointer",variant:"outline",onClick:()=>t(null),children:"Cancel"}),e.jsx(i,{className:"cursor-pointer",variant:"destructive",onClick:()=>{a&&(L(a.id,j),t(null))},disabled:!j.trim()||o===(a==null?void 0:a.id),children:"Confirm Rejection"})]})]})})]})}const ne=function(){return e.jsx(M,{})};export{ne as component};
