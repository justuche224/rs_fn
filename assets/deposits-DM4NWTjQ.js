import{r,j as e,B as l,al as A,t as n}from"./index-Beqj0qIe.js";import{B as v}from"./badge-CeV7kWRE.js";import{D as R,a as E,b as L,c as k,d as I}from"./dialog-CGfsmUZ7.js";import{T as Q,a as W,b as D,c as o,d as $,e as c}from"./table-COxDIALF.js";import{I as U}from"./input-DuPmauT3.js";import{S as X,a as K,b as Y,c as Z,d as h}from"./select-D2uGucAG.js";import{a as _,b as ee,r as se,f as ae}from"./deposits-CeK_A5WE.js";import{S as re}from"./search-BzJO0R18.js";import{F as te}from"./filter-B5_-uJ3x.js";import{L as ie}from"./loader-circle-cb7LCWPJ.js";import{C as le}from"./check-5vCNyr58.js";import"./index-DlMGmE-A.js";import"./index-ChZcIq3T.js";import"./chevron-down-Dob3Pb-U.js";function ne(){const[x,T]=r.useState([]),[w,C]=r.useState([]),[N,S]=r.useState(!0),[a,i]=r.useState(null),[b,F]=r.useState(""),[u,d]=r.useState(null),[P,j]=r.useState(!1),[B,f]=r.useState(!1),[p,z]=r.useState(""),[g,O]=r.useState("ALL"),m=async()=>{try{S(!0);const s=await _();T(s),C(s)}catch{n.error("Failed to fetch deposits data")}finally{S(!1)}};r.useEffect(()=>{let s=x;if(p){const t=p.toLowerCase();s=s.filter(y=>y.user.name.toLowerCase().includes(t)||y.user.email.toLowerCase().includes(t))}g!=="ALL"&&(s=s.filter(t=>t.status===g)),C(s)},[p,g,x]);const V=async s=>{d(s);try{await ee(s),n.success("Deposit approved successfully"),m()}catch{n.error("Failed to approve deposit")}finally{d(null)}},H=async(s,t)=>{if(!t.trim()){n.error("Rejection reason is required");return}d(s);try{await se(s,t),n.success("Deposit rejected successfully"),m(),j(!1),i(null)}catch{n.error("Failed to reject deposit")}finally{d(null)}},q=async s=>{d(s);try{await ae(s),n.success("Deposit marked as failed"),m(),f(!1),i(null)}catch{n.error("Failed to mark deposit as failed")}finally{d(null)}},G=s=>new Date(s).toLocaleString(),J=(s,t)=>`${s.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:8})} ${t}`,M=s=>{switch(s){case"APPROVED":return e.jsx(v,{className:"bg-green-500",children:"Approved"});case"REJECTED":return e.jsx(v,{variant:"destructive",children:"Rejected"});case"FAILED":return e.jsx(v,{className:"bg-gray-500",children:"Failed"});default:return e.jsx(v,{variant:"outline",className:"bg-yellow-100 text-yellow-800",children:"Pending"})}};return r.useEffect(()=>{m()},[]),e.jsxs("div",{className:"container mx-auto py-6 md:w-[90%] lg:w-[85%] px-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Deposits Administration"}),e.jsx(l,{onClick:m,disabled:N,className:"cursor-pointer",children:N?"Loading...":"Refresh"})]}),e.jsxs("div",{className:"mb-6 flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsx("div",{className:"flex items-center gap-2 w-full md:w-1/2",children:e.jsxs("div",{className:"relative w-full",children:[e.jsx(re,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(U,{placeholder:"Search by name or email",value:p,onChange:s=>z(s.target.value),className:"pl-8 w-full"})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs(X,{value:g,onValueChange:O,children:[e.jsx(K,{className:"w-[180px]",children:e.jsx(Y,{placeholder:"Filter by Status"})}),e.jsxs(Z,{children:[e.jsx(h,{value:"ALL",children:"All Statuses"}),e.jsx(h,{value:"PENDING",children:"Pending"}),e.jsx(h,{value:"APPROVED",children:"Approved"}),e.jsx(h,{value:"REJECTED",children:"Rejected"}),e.jsx(h,{value:"FAILED",children:"Failed"})]})]})]})]}),N?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(ie,{className:"animate-spin",size:40})}):e.jsx("div",{className:"bg-sidebar rounded-lg shadow overflow-hidden",children:e.jsxs(Q,{children:[e.jsx(W,{children:e.jsxs(D,{children:[e.jsx(o,{children:"User"}),e.jsx(o,{children:"Email"}),e.jsx(o,{children:"Wallet ID"}),e.jsx(o,{children:"Amount"}),e.jsx(o,{children:"Status"}),e.jsx(o,{children:"Date"}),e.jsx(o,{className:"text-right",children:"Actions"})]})}),e.jsx($,{children:w.length===0?e.jsx(D,{children:e.jsx(c,{colSpan:7,className:"text-center py-8",children:x.length===0?"No deposits found":"No deposits match your search criteria"})}):w.map(s=>e.jsxs(D,{children:[e.jsx(c,{className:"font-medium",children:s.user.name||s.user.id.substring(0,8)+"..."}),e.jsx(c,{className:"text-sm text-muted-foreground",children:s.user.email}),e.jsx(c,{className:"font-mono text-sm",children:s.systemWalletId.substring(0,8)+"..."}),e.jsx(c,{children:J(s.amount,s.currency)}),e.jsx(c,{children:M(s.status)}),e.jsx(c,{children:G(s.createdAt)}),e.jsx(c,{className:"text-right",children:e.jsx("div",{className:"flex justify-end gap-2",children:s.status==="PENDING"&&e.jsxs(e.Fragment,{children:[e.jsxs(l,{variant:"default",size:"sm",className:"bg-green-600 hover:bg-green-700 cursor-pointer",onClick:()=>V(s.id),disabled:u===s.id,children:[e.jsx(le,{className:"h-4 w-4 mr-1"}),"Approve"]}),e.jsxs(l,{variant:"destructive",size:"sm",className:"cursor-pointer",onClick:()=>{i(s),F(""),j(!0)},disabled:u===s.id,children:[e.jsx(A,{className:"h-4 w-4 mr-1"}),"Reject"]}),e.jsxs(l,{variant:"outline",size:"sm",className:"cursor-pointer text-orange-500 border-orange-500 hover:bg-orange-50",onClick:()=>{i(s),f(!0)},disabled:u===s.id,children:[e.jsx(A,{className:"h-4 w-4 mr-1"}),"Mark Failed"]})]})})})]},s.id))})]})}),e.jsx(R,{open:!!a&&P,onOpenChange:s=>{s||(i(null),j(!1))},children:e.jsxs(E,{children:[e.jsxs(L,{children:[e.jsx(k,{children:"Reject Deposit"}),e.jsx(I,{children:"Please provide a reason for rejecting this deposit."})]}),e.jsx("div",{className:"grid gap-4 py-4",children:e.jsx("textarea",{className:"min-h-[100px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",placeholder:"Enter rejection reason...",value:b,onChange:s=>F(s.target.value)})}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(l,{className:"cursor-pointer",variant:"outline",onClick:()=>{i(null),j(!1)},children:"Cancel"}),e.jsx(l,{className:"cursor-pointer",variant:"destructive",onClick:()=>{a&&H(a.id,b)},disabled:!b.trim()||u===(a==null?void 0:a.id),children:"Confirm Rejection"})]})]})}),e.jsx(R,{open:!!a&&B,onOpenChange:s=>{s||(i(null),f(!1))},children:e.jsxs(E,{children:[e.jsxs(L,{children:[e.jsx(k,{children:"Mark Deposit as Failed"}),e.jsx(I,{children:"Are you sure you want to mark this deposit as failed? This action indicates a technical or processing issue with the deposit."})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx(l,{className:"cursor-pointer",variant:"outline",onClick:()=>{i(null),f(!1)},children:"Cancel"}),e.jsx(l,{className:"cursor-pointer",variant:"secondary",onClick:()=>{a&&q(a.id)},disabled:u===(a==null?void 0:a.id),children:"Confirm Failure"})]})]})})]})}const ye=function(){return e.jsx(ne,{})};export{ye as component};
