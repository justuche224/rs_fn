import{s as he,r as l,j as e,B as i,ax as xe,t as c,ay as ue,az as je,aA as ge,aB as pe}from"./index-DN1k3KKq.js";import{B as n}from"./badge-Dq9VV3PW.js";import{D as M,a as q,b as K,c as Q,d as W,e as X}from"./dialog-BVJZ4FRB.js";import{T as fe,a as Ne,b as V,c as m,d as be,e as d}from"./table-CdQYSvdX.js";import{I as Y}from"./input-B8TrRtHR.js";import{T as _,C as G}from"./checkbox-CP5Mc0Ze.js";import{A as ye,a as ve,b as Se,c as Ce,d as we,e as De,f as Ae,g as Ue}from"./alert-dialog-DiUyumxO.js";import{S as Be,a as ke,b as Te,c as Le,d as u}from"./select-BWdKwOP-.js";import{L as J}from"./label-CHrB_F8p.js";import{S as ze}from"./search-DV7WEHQ-.js";import{L as C}from"./loader-circle-BxB1fXUE.js";import{E as Ve}from"./eye-CBy2dKBn.js";import{W as Ee}from"./wallet-BAnxHble.js";import"./index-BM___sn_.js";import"./check-raCUypK4.js";import"./index-i396ggAK.js";import"./chevron-down-CQfk8IJH.js";/**
 * @license lucide-react v0.476.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]],Oe=he("UserX",Fe);function Ie(){const[w,Z]=l.useState([]),[j,D]=l.useState([]),[A,E]=l.useState(!0),[g,ee]=l.useState(""),[t,h]=l.useState(new Set),[r,F]=l.useState(null),[se,y]=l.useState(!1),[ae,p]=l.useState(!1),[f,O]=l.useState(!1),[le,v]=l.useState(!1),[I,H]=l.useState(null),[N,U]=l.useState(""),[b,B]=l.useState(""),[x,k]=l.useState(!1),[re,R]=l.useState(!1),[T,S]=l.useState(null),L=async()=>{try{E(!0);const s=await xe();Z(s),D(s)}catch{c.error("Failed to fetch users")}finally{E(!1)}};l.useEffect(()=>{L()},[]),l.useEffect(()=>{if(g.trim()==="")D(w);else{const s=g.toLowerCase();D(w.filter(a=>{var o;return((o=a.name)==null?void 0:o.toLowerCase().includes(s))||a.email.toLowerCase().includes(s)||a.id.toLowerCase().includes(s)}))}},[g,w]);const te=async s=>{try{const a=await ue(s);F(a),y(!0)}catch{c.error("Failed to fetch user details")}},ne=async()=>{if(t.size!==0)try{O(!0),await je(Array.from(t)),c.success(`Successfully deleted ${t.size} user(s)`),h(new Set),L()}catch{c.error("Failed to delete users")}finally{O(!1),p(!1)}},ie=s=>{const a=new Set(t);a.has(s)?a.delete(s):a.add(s),h(a)},ce=()=>{t.size===j.length?h(new Set):h(new Set(j.map(s=>s.id)))},z=s=>new Date(s).toLocaleString(),$=s=>s==="ADMIN"?e.jsx(n,{className:"bg-purple-500",children:"Admin"}):e.jsx(n,{variant:"outline",children:"User"}),P=s=>s?e.jsx(n,{className:"bg-green-500",children:"Verified"}):e.jsx(n,{variant:"outline",className:"bg-yellow-100 text-yellow-800",children:"Unverified"}),de=async s=>{H(s),U(""),B(""),S(null),R(!0),v(!0),k(!1);try{const a=await ge(s);S(a)}catch(a){console.error("Failed to fetch user balances:",a),c.error("Failed to load user balances")}finally{R(!1)}},oe=async()=>{var s,a;if(!I||!N||!b){c.error("Please select a currency and enter an amount.");return}if(!/^-?\d+$/.test(b)){c.error("Amount must be a whole number (positive or negative).");return}k(!0);try{const o=await pe({userId:I,currency:N,amount:b});c.success(`Successfully adjusted ${N} balance. New balance: ${o.newBalance}`),v(!1),S(null)}catch(o){console.error("Balance adjustment error:",o);const me=((a=(s=o.response)==null?void 0:s.data)==null?void 0:a.error)||o.message||"Failed to adjust balance";c.error(me)}finally{k(!1)}};return e.jsxs("div",{className:"container mx-auto py-6 md:w-[90%] lg:w-[85%] px-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"User Management"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ze,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(Y,{type:"text",placeholder:"Search users...",className:"pl-8 pr-4",value:g,onChange:s=>ee(s.target.value)})]}),e.jsx(i,{onClick:L,disabled:A,className:"cursor-pointer",children:A?"Loading...":"Refresh"}),t.size>0&&e.jsxs(i,{variant:"destructive",onClick:()=>p(!0),className:"cursor-pointer",disabled:f,children:[e.jsx(_,{className:"h-4 w-4 mr-1"}),"Delete (",t.size,")"]})]})]}),A?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(C,{className:"animate-spin",size:40})}):e.jsx("div",{className:"bg-sidebar rounded-lg shadow overflow-hidden",children:e.jsxs(fe,{children:[e.jsx(Ne,{children:e.jsxs(V,{children:[e.jsx(m,{className:"w-12",children:e.jsx(G,{checked:t.size>0&&t.size===j.length,onCheckedChange:ce,className:"cursor-pointer","aria-label":"Select all users"})}),e.jsx(m,{children:"Name"}),e.jsx(m,{children:"Email"}),e.jsx(m,{children:"Role"}),e.jsx(m,{children:"Status"}),e.jsx(m,{children:"KYC"}),e.jsx(m,{children:"Created"}),e.jsx(m,{className:"text-right",children:"Actions"})]})}),e.jsx(be,{children:j.length===0?e.jsx(V,{children:e.jsx(d,{colSpan:8,className:"text-center py-8",children:g?"No users found matching your search":"No users found"})}):j.map(s=>e.jsxs(V,{children:[e.jsx(d,{children:e.jsx(G,{checked:t.has(s.id),onCheckedChange:()=>ie(s.id),className:"cursor-pointer","aria-label":`Select ${s.name||"user"}`})}),e.jsx(d,{className:"font-medium",children:s.name||s.id.substring(0,8)+"..."}),e.jsx(d,{children:s.email}),e.jsx(d,{children:$(s.role)}),e.jsx(d,{children:P(s.emailVerified)}),e.jsx(d,{children:s.kycVerified?e.jsx(n,{className:"bg-green-500",children:"Verified"}):e.jsx(n,{variant:"outline",className:"bg-gray-100",children:"Not Verified"})}),e.jsx(d,{children:z(s.createdAt)}),e.jsx(d,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsxs(i,{className:"cursor-pointer",variant:"outline",size:"sm",onClick:()=>te(s.id),children:[e.jsx(Ve,{className:"h-4 w-4 mr-1"}),"View"]}),e.jsxs(i,{className:"cursor-pointer",variant:"outline",size:"sm",onClick:()=>de(s.id),children:[e.jsx(Ee,{className:"h-4 w-4 mr-1"}),"Adjust"]}),e.jsxs(i,{variant:"destructive",size:"sm",className:"cursor-pointer",onClick:()=>{h(new Set([s.id])),p(!0)},children:[e.jsx(Oe,{className:"h-4 w-4 mr-1"}),"Delete"]})]})})]},s.id))})]})}),e.jsx(M,{open:se,onOpenChange:s=>{y(s),s||F(null)},children:e.jsxs(q,{className:"max-w-xl",children:[e.jsxs(K,{children:[e.jsx(Q,{children:"User Details"}),e.jsx(W,{children:"Detailed information about this user."})]}),r&&e.jsx("div",{className:"grid gap-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"User ID:"}),e.jsx("p",{className:"text-sm text-gray-600",children:r.id})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Role:"}),e.jsx("p",{children:$(r.role)})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Name:"}),e.jsx("p",{className:"text-sm",children:r.name||"Not provided"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Email:"}),e.jsx("p",{className:"text-sm",children:r.email})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Email Verification:"}),e.jsx("p",{children:P(r.emailVerified)})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"KYC Status:"}),e.jsx("p",{children:r.kycVerified?e.jsx(n,{className:"bg-green-500",children:"Verified"}):e.jsx(n,{variant:"outline",className:"bg-gray-100",children:"Not Verified"})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Phone:"}),e.jsx("p",{className:"text-sm",children:r.phone||"Not provided"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"2FA Enabled:"}),e.jsx("p",{children:r.twoFactorEnabled?e.jsx(n,{className:"bg-green-500",children:"Enabled"}):e.jsx(n,{variant:"outline",children:"Disabled"})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Created At:"}),e.jsx("p",{className:"text-sm",children:z(r.createdAt)})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Last Updated:"}),e.jsx("p",{className:"text-sm",children:z(r.updatedAt)})]})]})}),e.jsxs(X,{children:[e.jsx(i,{variant:"outline",onClick:()=>y(!1),className:"cursor-pointer",children:"Close"}),e.jsxs(i,{variant:"destructive",onClick:()=>{r&&(y(!1),h(new Set([r.id])),p(!0))},className:"cursor-pointer",children:[e.jsx(_,{className:"h-4 w-4 mr-1"}),"Delete User"]})]})]})}),e.jsx(ye,{open:ae,onOpenChange:s=>{p(s),!s&&!f&&h(new Set)},children:e.jsxs(ve,{children:[e.jsxs(Se,{children:[e.jsx(Ce,{children:"Confirm User Deletion"}),e.jsx(we,{children:t.size>1?`Are you sure you want to delete ${t.size} users? This action cannot be undone.`:"Are you sure you want to delete this user? This action cannot be undone."})]}),e.jsxs(De,{children:[e.jsx(Ae,{disabled:f,children:"Cancel"}),e.jsx(Ue,{onClick:s=>{s.preventDefault(),ne()},disabled:f,className:"bg-red-600 text-white hover:bg-red-700",children:f?e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"mr-2 h-4 w-4 animate-spin"}),"Deleting..."]}):"Delete"})]})]})}),e.jsx(M,{open:le,onOpenChange:s=>{x||(v(s),s||(H(null),U(""),B(""),S(null)))},children:e.jsxs(q,{className:"sm:max-w-[425px]",children:[e.jsxs(K,{children:[e.jsx(Q,{children:"Adjust User Balance"}),e.jsx(W,{children:"View current balances and adjust for a specific currency. Enter the amount to add (e.g., 100) or remove (e.g., -50)."})]}),re?e.jsxs("div",{className:"flex justify-center items-center py-4",children:[e.jsx(C,{className:"animate-spin mr-2"})," Loading balances..."]}):T?e.jsxs("div",{className:"my-4 px-1",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Current Balances:"}),e.jsxs("div",{className:"text-sm grid grid-cols-3 gap-x-4 gap-y-1",children:[Object.entries(T).map(([s,a])=>e.jsxs("div",{children:[e.jsxs("span",{className:"font-medium",children:[s,":"]})," ",String(a)]},s)),Object.keys(T).length===0&&e.jsx("div",{className:"col-span-3 text-gray-500",children:"No balances found."})]})]}):e.jsx("div",{className:"text-center py-4 text-gray-500",children:"Could not load balances."}),e.jsxs("div",{className:"grid gap-4 pt-1 pb-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(J,{htmlFor:"currency",className:"text-right",children:"Currency"}),e.jsxs(Be,{value:N,onValueChange:s=>U(s),disabled:x,children:[e.jsx(ke,{className:"col-span-3",id:"currency",children:e.jsx(Te,{placeholder:"Select Currency"})}),e.jsxs(Le,{children:[e.jsx(u,{value:"BTC",children:"BTC"}),e.jsx(u,{value:"ETH",children:"ETH"}),e.jsx(u,{value:"USDT",children:"USDT"}),e.jsx(u,{value:"SOL",children:"SOL"}),e.jsx(u,{value:"BNB",children:"BNB"}),e.jsx(u,{value:"LTC",children:"LTC"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(J,{htmlFor:"amount",className:"text-right",children:"Amount"}),e.jsx(Y,{id:"amount",type:"number",placeholder:"e.g., 100 or -50",value:b,onChange:s=>B(s.target.value),className:"col-span-3",disabled:x})]})]}),e.jsxs(X,{children:[e.jsx(i,{variant:"outline",onClick:()=>v(!1),disabled:x,className:"cursor-pointer",children:"Cancel"}),e.jsx(i,{onClick:oe,disabled:x||!N||b==="",className:"cursor-pointer",children:x?e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"mr-2 h-4 w-4 animate-spin"}),"Adjusting..."]}):"Adjust Balance"})]})]})})]})}const as=Ie;export{as as component};
