import{r as l,j as e,B as i,al as oe,t as r}from"./index-azKcz7jo.js";import{B as E}from"./badge-0pREEFCl.js";import{C as D,c as R,d as W,e as G,a as O}from"./card-D_8Q0gDY.js";import{D as I,a as B,b as V,c as M,d as z,e as H}from"./dialog-DWG8rJ75.js";import{T as Ee,a as ke,b as Q,c as x,d as Te,e as m}from"./table-B3b2cMEs.js";import{I as v}from"./input-emP456Tw.js";import{L as j}from"./label-BYY_DBvi.js";import{S as qe}from"./switch-D3h4qHHN.js";import{S as U,a as $,b as J,c as K,d as g}from"./select-Cen9QJ_h.js";import{T as De,a as Re,b as X,c as Y}from"./tabs-Cc__cCP7.js";import{N as We,a as Ge,b as Oe,c as Ie,u as Be,d as Ve,e as Me,f as ze,h as He,r as Qe}from"./liquidation-CVtWk9vW.js";import{L as k}from"./loader-circle-Hhqc7pXq.js";import{S as Ue}from"./settings-D13GVKO6.js";import{W as $e}from"./wallet-CCANQxSi.js";import{P as Je}from"./plus-acw40NlL.js";import{T as Ke}from"./trash-2-Cdzk8twS.js";import{I as Xe}from"./info-DA5QEknh.js";import{A as me}from"./arrow-right-BCliDvI4.js";import{S as Ye}from"./search-Bp0cW7zb.js";import{F as Ze}from"./filter-B5ELycEk.js";import{C as ue}from"./check-CGX033sd.js";import"./index-My5jOcE9.js";import"./index-CAPtXYRJ.js";import"./chevron-down-ClOk7GOx.js";const _e=["BTC","ETH","USDT","SOL","BNB","LTC"];function es(){var ie;const[w,Z]=l.useState(!0),[,xe]=l.useState(null),[_,he]=l.useState([]),[T,je]=l.useState([]),[ee,se]=l.useState([]),[b,ge]=l.useState(""),[y,pe]=l.useState("ALL"),[h,p]=l.useState(null),[d,C]=l.useState({maxLiquidationPercentage:"",gasFeePercentage:"",isEnabled:!1}),[ae,te]=l.useState(!1),[fe,S]=l.useState(!1),[c,L]=l.useState({currency:"",network:"",address:""}),[Ne,le]=l.useState(null),[re,ne]=l.useState(!1),[a,o]=l.useState(null),[q,A]=l.useState(""),[ve,f]=l.useState(!1),[we,F]=l.useState(!1),u=async()=>{var s,t;try{Z(!0);const[n,P,N]=await Promise.all([Ge(),Oe(),Ie()]);xe(n),he(P),je(N),se(N),n&&C({maxLiquidationPercentage:((s=n.maxLiquidationPercentage)==null?void 0:s.toString())||"",gasFeePercentage:((t=n.gasFeePercentage)==null?void 0:t.toString())||"",isEnabled:n.isEnabled||!1})}catch{r.error("Failed to fetch liquidation data")}finally{Z(!1)}};l.useEffect(()=>{u()},[]),l.useEffect(()=>{let s=T;if(b){const t=b.toLowerCase();s=s.filter(n=>{var P,N,ce,de;return((N=(P=n.user)==null?void 0:P.name)==null?void 0:N.toLowerCase().includes(t))||((de=(ce=n.user)==null?void 0:ce.email)==null?void 0:de.toLowerCase().includes(t))||n.targetCrypto.toLowerCase().includes(t)})}y!=="ALL"&&(s=s.filter(t=>t.status===y)),se(s)},[b,y,T]);const be=async()=>{try{te(!0),await Be(d.maxLiquidationPercentage?parseFloat(d.maxLiquidationPercentage):null,d.gasFeePercentage?parseFloat(d.gasFeePercentage):null,d.isEnabled),r.success("Settings saved successfully"),u()}catch{r.error("Failed to save settings")}finally{te(!1)}},ye=async()=>{if(!c.currency||!c.network||!c.address){r.error("Please fill all fields");return}try{ne(!0),await Ve(c.currency,c.network,c.address,Ne||void 0),r.success("Gas wallet added successfully"),S(!1),L({currency:"",network:"",address:""}),le(null),u()}catch(s){r.error(s instanceof Error?s.message:"Failed to add gas wallet")}finally{ne(!1)}},Ce=async s=>{if(confirm("Are you sure you want to delete this gas wallet?"))try{await Me(s),r.success("Gas wallet deleted successfully"),u()}catch{r.error("Failed to delete gas wallet")}},Se=async s=>{p(s);try{await ze(s),r.success("Liquidation approved successfully"),u()}catch{r.error("Failed to approve liquidation")}finally{p(null)}},Le=async s=>{p(s);try{await He(s),r.success("Liquidation completed successfully"),u(),F(!1),o(null)}catch{r.error("Failed to complete liquidation")}finally{p(null)}},Ae=async(s,t)=>{if(!t.trim()){r.error("Rejection reason is required");return}p(s);try{await Qe(s,t),r.success("Liquidation rejected successfully"),u(),f(!1),o(null),A("")}catch{r.error("Failed to reject liquidation")}finally{p(null)}},Fe=s=>new Date(s).toLocaleString(),Pe=s=>{switch(s){case"COMPLETED":return e.jsx(E,{className:"bg-green-500",children:"Completed"});case"APPROVED":return e.jsx(E,{className:"bg-blue-500",children:"Approved"});case"REJECTED":return e.jsx(E,{variant:"destructive",children:"Rejected"});default:return e.jsx(E,{variant:"outline",className:"bg-yellow-100 text-yellow-800",children:"Pending"})}};return w?e.jsx("div",{className:"flex h-full min-h-96 items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(k,{className:"mx-auto h-8 w-8 animate-spin text-primary"}),e.jsx("p",{className:"mt-2 text-lg",children:"Loading liquidation data..."})]})}):e.jsxs("div",{className:"container mx-auto py-6 md:w-[90%] lg:w-[85%] px-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Liquidation Management"}),e.jsx(i,{onClick:u,disabled:w,children:w?"Loading...":"Refresh"})]}),e.jsxs(De,{defaultValue:"requests",className:"space-y-6",children:[e.jsxs(Re,{className:"grid w-full grid-cols-3 max-w-md",children:[e.jsx(X,{value:"requests",children:"Requests"}),e.jsx(X,{value:"settings",children:"Settings"}),e.jsx(X,{value:"wallets",children:"Gas Wallets"})]}),e.jsx(Y,{value:"settings",children:e.jsxs(D,{children:[e.jsxs(R,{children:[e.jsxs(W,{className:"flex items-center gap-2",children:[e.jsx(Ue,{className:"h-5 w-5"}),"Liquidation Settings"]}),e.jsx(G,{children:"Configure liquidation parameters and enable/disable the feature"})]}),e.jsxs(O,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(j,{children:"Enable Liquidation"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Allow users to liquidate their assets"})]}),e.jsx(qe,{checked:d.isEnabled,onCheckedChange:s=>C({...d,isEnabled:s})})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Max Liquidation Percentage"}),e.jsxs("div",{className:"relative",children:[e.jsx(v,{type:"number",placeholder:"e.g., 80",value:d.maxLiquidationPercentage,onChange:s=>C({...d,maxLiquidationPercentage:s.target.value}),min:"1",max:"100"}),e.jsx("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground",children:"%"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Maximum percentage of balance users can liquidate"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Gas Fee Percentage"}),e.jsxs("div",{className:"relative",children:[e.jsx(v,{type:"number",placeholder:"e.g., 5",value:d.gasFeePercentage,onChange:s=>C({...d,gasFeePercentage:s.target.value}),min:"0",max:"100"}),e.jsx("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground",children:"%"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Gas fee charged on liquidation amount"})]})]}),e.jsx(i,{onClick:be,disabled:ae,className:"w-full md:w-auto",children:ae?e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving..."]}):"Save Settings"})]})]})}),e.jsx(Y,{value:"wallets",children:e.jsxs(D,{children:[e.jsxs(R,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(W,{className:"flex items-center gap-2",children:[e.jsx($e,{className:"h-5 w-5"}),"Gas Fee Wallets"]}),e.jsx(G,{children:"Manage wallets for receiving gas fee payments"})]}),e.jsxs(i,{onClick:()=>S(!0),children:[e.jsx(Je,{className:"h-4 w-4 mr-2"}),"Add Wallet"]})]}),e.jsx(O,{children:_.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No gas wallets configured. Add a wallet to enable liquidations."}):e.jsx("div",{className:"space-y-4",children:_.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-lg border",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx("span",{className:"font-bold text-primary",children:s.currency.charAt(0)})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:[s.currency," - ",s.network]}),e.jsx("p",{className:"text-sm text-muted-foreground font-mono truncate max-w-xs",children:s.address})]})]}),e.jsx(i,{variant:"destructive",size:"icon",onClick:()=>Ce(s.id),children:e.jsx(Ke,{className:"h-4 w-4"})})]},s.id))})})]})}),e.jsxs(Y,{value:"requests",children:[e.jsxs(D,{className:"mb-6 border-amber-200 bg-amber-50/50",children:[e.jsxs(R,{className:"pb-3",children:[e.jsxs(W,{className:"text-base flex items-center gap-2",children:[e.jsx(Xe,{className:"h-4 w-4 text-amber-600"}),"Liquidation Workflow Guide"]}),e.jsx(G,{children:"Understanding the liquidation process and when to use each action"})]}),e.jsxs(O,{children:[e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center gap-4 mb-4",children:[e.jsx("div",{className:"flex items-center gap-2 px-3 py-2 bg-yellow-100 rounded-lg",children:e.jsx("span",{className:"font-medium text-sm",children:"PENDING"})}),e.jsx(me,{className:"h-4 w-4 text-muted-foreground hidden md:block"}),e.jsx("div",{className:"flex items-center gap-2 px-3 py-2 bg-blue-100 rounded-lg",children:e.jsx("span",{className:"font-medium text-sm",children:"APPROVED"})}),e.jsx(me,{className:"h-4 w-4 text-muted-foreground hidden md:block"}),e.jsx("div",{className:"flex items-center gap-2 px-3 py-2 bg-green-100 rounded-lg",children:e.jsx("span",{className:"font-medium text-sm",children:"COMPLETED"})})]}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"font-semibold text-blue-600 min-w-[80px]",children:"Approve:"}),e.jsxs("p",{className:"text-muted-foreground",children:["Click when you've reviewed the request and it's valid. ",e.jsx("span",{className:"text-amber-600 font-medium",children:"Balance is NOT deducted yet."})," The request is reserved and waiting for you to send the funds."]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"font-semibold text-green-600 min-w-[80px]",children:"Complete:"}),e.jsxs("p",{className:"text-muted-foreground",children:["Click ",e.jsx("span",{className:"text-green-600 font-medium",children:"AFTER you've sent the crypto"})," to the user's wallet. ",e.jsx("span",{className:"text-green-600 font-medium",children:"This deducts the balance"})," from the user's account."]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"font-semibold text-red-600 min-w-[80px]",children:"Reject:"}),e.jsx("p",{className:"text-muted-foreground",children:"Click to deny the request. Provide a reason so the user understands why. Can be done from Pending or Approved status."})]})]})]})]}),e.jsxs("div",{className:"mb-6 flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsx("div",{className:"flex items-center gap-2 w-full md:w-1/2",children:e.jsxs("div",{className:"relative w-full",children:[e.jsx(Ye,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(v,{placeholder:"Search by name, email, or crypto...",value:b,onChange:s=>ge(s.target.value),className:"pl-8 w-full"})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ze,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs(U,{value:y,onValueChange:pe,children:[e.jsx($,{className:"w-[180px]",children:e.jsx(J,{placeholder:"Filter by Status"})}),e.jsxs(K,{children:[e.jsx(g,{value:"ALL",children:"All Statuses"}),e.jsx(g,{value:"PENDING",children:"Pending"}),e.jsx(g,{value:"APPROVED",children:"Approved"}),e.jsx(g,{value:"COMPLETED",children:"Completed"}),e.jsx(g,{value:"REJECTED",children:"Rejected"})]})]})]})]}),e.jsx("div",{className:"bg-sidebar rounded-lg shadow overflow-hidden",children:e.jsxs(Ee,{children:[e.jsx(ke,{children:e.jsxs(Q,{children:[e.jsx(x,{children:"User"}),e.jsx(x,{children:"Amount"}),e.jsx(x,{children:"Target"}),e.jsx(x,{children:"Gas Fee"}),e.jsx(x,{children:"Wallet"}),e.jsx(x,{children:"Status"}),e.jsx(x,{children:"Date"}),e.jsx(x,{className:"text-right",children:"Actions"})]})}),e.jsx(Te,{children:ee.length===0?e.jsx(Q,{children:e.jsx(m,{colSpan:8,className:"text-center py-8",children:T.length===0?"No liquidation requests":"No liquidations match your search criteria"})}):ee.map(s=>{var t,n;return e.jsxs(Q,{children:[e.jsx(m,{children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:((t=s.user)==null?void 0:t.name)||"N/A"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:((n=s.user)==null?void 0:n.email)||"N/A"})]})}),e.jsx(m,{children:e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:["$",parseFloat(s.sourceAmount).toFixed(2)]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.sourceCurrency})]})}),e.jsx(m,{children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.targetCrypto}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.targetNetwork})]})}),e.jsxs(m,{children:["$",parseFloat(s.gasFeeAmount).toFixed(2)]}),e.jsx(m,{children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm",children:s.walletProvider}),e.jsx("p",{className:"text-xs text-muted-foreground font-mono truncate max-w-[100px]",children:s.walletAddress})]})}),e.jsx(m,{children:Pe(s.status)}),e.jsx(m,{className:"text-sm",children:Fe(s.createdAt)}),e.jsx(m,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[s.status==="PENDING"&&e.jsxs(e.Fragment,{children:[e.jsxs(i,{variant:"default",size:"sm",className:"bg-blue-600 hover:bg-blue-700",onClick:()=>Se(s.id),disabled:h===s.id,children:[e.jsx(ue,{className:"h-4 w-4 mr-1"}),"Approve"]}),e.jsxs(i,{variant:"destructive",size:"sm",onClick:()=>{o(s),A(""),f(!0)},disabled:h===s.id,children:[e.jsx(oe,{className:"h-4 w-4 mr-1"}),"Reject"]})]}),s.status==="APPROVED"&&e.jsxs(e.Fragment,{children:[e.jsxs(i,{variant:"default",size:"sm",className:"bg-green-600 hover:bg-green-700",onClick:()=>{o(s),F(!0)},disabled:h===s.id,children:[e.jsx(ue,{className:"h-4 w-4 mr-1"}),"Complete"]}),e.jsxs(i,{variant:"destructive",size:"sm",onClick:()=>{o(s),A(""),f(!0)},disabled:h===s.id,children:[e.jsx(oe,{className:"h-4 w-4 mr-1"}),"Reject"]})]})]})})]},s.id)})})]})})]})]}),e.jsx(I,{open:fe,onOpenChange:S,children:e.jsxs(B,{children:[e.jsxs(V,{children:[e.jsx(M,{children:"Add Gas Fee Wallet"}),e.jsx(z,{children:"Add a new wallet for receiving gas fee payments"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Currency"}),e.jsxs(U,{value:c.currency,onValueChange:s=>L({...c,currency:s}),children:[e.jsx($,{children:e.jsx(J,{placeholder:"Select currency"})}),e.jsx(K,{children:_e.map(s=>e.jsx(g,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Network"}),e.jsxs(U,{value:c.network,onValueChange:s=>L({...c,network:s}),children:[e.jsx($,{children:e.jsx(J,{placeholder:"Select network"})}),e.jsx(K,{children:We.map(s=>e.jsx(g,{value:s.value,children:s.label},s.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Wallet Address"}),e.jsx(v,{placeholder:"Enter wallet address",value:c.address,onChange:s=>L({...c,address:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"QR Code (Optional)"}),e.jsx(v,{type:"file",accept:"image/*",onChange:s=>{var t;return le(((t=s.target.files)==null?void 0:t[0])||null)}})]})]}),e.jsxs(H,{children:[e.jsx(i,{variant:"outline",onClick:()=>S(!1),children:"Cancel"}),e.jsx(i,{onClick:ye,disabled:re,children:re?e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"mr-2 h-4 w-4 animate-spin"}),"Adding..."]}):"Add Wallet"})]})]})}),e.jsx(I,{open:!!a&&ve,onOpenChange:s=>{s||(o(null),f(!1))},children:e.jsxs(B,{children:[e.jsxs(V,{children:[e.jsx(M,{children:"Reject Liquidation"}),e.jsx(z,{children:"Please provide a reason for rejecting this liquidation request."})]}),e.jsx("div",{className:"grid gap-4 py-4",children:e.jsx("textarea",{className:"min-h-[100px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",placeholder:"Enter rejection reason...",value:q,onChange:s=>A(s.target.value)})}),e.jsxs(H,{children:[e.jsx(i,{variant:"outline",onClick:()=>{o(null),f(!1)},children:"Cancel"}),e.jsx(i,{variant:"destructive",onClick:()=>{a&&Ae(a.id,q)},disabled:!q.trim()||h===(a==null?void 0:a.id),children:"Confirm Rejection"})]})]})}),e.jsx(I,{open:!!a&&we,onOpenChange:s=>{s||(o(null),F(!1))},children:e.jsxs(B,{children:[e.jsxs(V,{children:[e.jsx(M,{children:"Complete Liquidation"}),e.jsx(z,{children:"Are you sure you want to mark this liquidation as complete? This will deduct the amount from the user's balance."})]}),a&&e.jsxs("div",{className:"py-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"User"}),e.jsx("span",{children:((ie=a.user)==null?void 0:ie.name)||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Amount"}),e.jsxs("span",{children:["$",parseFloat(a.sourceAmount).toFixed(2)," ",a.sourceCurrency]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Target"}),e.jsxs("span",{children:[a.targetCrypto," (",a.targetNetwork,")"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Wallet"}),e.jsx("span",{className:"text-sm font-mono truncate max-w-[200px]",children:a.walletAddress})]})]}),e.jsxs(H,{children:[e.jsx(i,{variant:"outline",onClick:()=>{o(null),F(!1)},children:"Cancel"}),e.jsx(i,{className:"bg-green-600 hover:bg-green-700",onClick:()=>{a&&Le(a.id)},disabled:h===(a==null?void 0:a.id),children:h===(a==null?void 0:a.id)?e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"mr-2 h-4 w-4 animate-spin"}),"Processing..."]}):"Complete Liquidation"})]})]})})]})}const Ss=function(){return e.jsx(es,{})};export{Ss as component};
