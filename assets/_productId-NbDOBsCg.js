import{aW as S,r as o,u as V,z as c,j as e,L as z,B as w,aE as O,aX as T}from"./index-DV2HeXgk.js";import{A as D}from"./accent-card-DsMRVKGP.js";import{u as M,s as W,F as X,a as d,b as m,c as u,d as x,e as p,f as G,g as H}from"./form-success-BKGilWab.js";import{I as g}from"./input-V_F_QeYU.js";import{S as J,a as K,b as Q,c as Y,d as b}from"./select-Bw_0vPwR.js";import{A as Z}from"./arrow-left-DzY_aMk9.js";import{L as P}from"./loader-circle-C0MEZKE-.js";import"./card-DsfIOjkV.js";import"./proxy-xQdllVL2.js";import"./label-quc9jPju.js";import"./triangle-alert-C83j65vz.js";import"./circle-check-CV-bpT4z.js";import"./index-xmMZZbHx.js";import"./index-B1OQIASW.js";import"./chevron-down-BGFhvxn2.js";import"./check-B3rc1eVU.js";const _=c.object({name:c.string().min(3,"Name must be at least 3 characters long"),price:c.number(),description:c.string().min(3,"Description must be at least 3 characters long"),categoryId:c.string().min(3,"Category must be at least 3 characters long"),img:c.instanceof(File,{message:"Product image is required"}).optional().or(c.literal("")).refine(l=>!l||l===""?!0:l instanceof File&&l.size<=5*1024*1024,{message:"File size must be less than 5MB"})}),ge=function(){const{product:s}=S.useLoaderData(),[i,L]=o.useTransition(),[U,j]=o.useState(""),[I,v]=o.useState(""),[a,E]=o.useState(s.imageUrl),[y,R]=o.useState([]),[h,C]=o.useState(!0),N=V(),k=S.useParams(),n=M({resolver:W(_),defaultValues:{name:s.name,price:parseFloat(s.price),description:s.description,categoryId:s.categoryId,img:void 0}});o.useEffect(()=>{(async()=>{try{C(!0);const r=await O();R(r)}catch(r){j("Failed to load categories"),console.error("Error loading categories:",r)}finally{C(!1)}})()},[]);function A(t){j(void 0),v(void 0),L(async()=>{try{await T(k.productId,t.name,t.price.toString(),t.description,t.categoryId,t.img instanceof File?t.img:void 0),v("Product updated successfully"),N({to:"/admin/products"})}catch(r){j(r instanceof Error?r.message:"Failed to update product")}})}return o.useEffect(()=>()=>{a&&a!==s.imageUrl&&URL.revokeObjectURL(a)},[a,s.imageUrl]),s?e.jsx("div",{className:"h-full flex justify-center mt-10 container max-w-2xl w-full mx-auto",children:e.jsxs(D,{className:"max-w-2xl mx-auto lg:w-2xl md:w-xl sm:w-lg",title:"Edit Product",description:"Update product information",children:[e.jsx("div",{className:"mb-4",children:e.jsxs(z,{to:"/admin/products",className:"flex items-center gap-1 text-sm text-gray-600 hover:text-gray-900",children:[e.jsx(Z,{className:"h-4 w-4"}),"Back to Products"]})}),e.jsx(X,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(A),className:"space-y-6",children:[e.jsx(d,{control:n.control,name:"categoryId",disabled:i||h,render:({field:t})=>e.jsxs(m,{children:[e.jsx(u,{children:"Product Category"}),e.jsxs(J,{onValueChange:t.onChange,defaultValue:t.value,children:[e.jsx(x,{children:e.jsx(K,{children:e.jsx(Q,{placeholder:h?"Loading categories...":"Select Category"})})}),e.jsx(Y,{children:h?e.jsx(b,{value:"loading",disabled:!0,children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(P,{className:"h-4 w-4 animate-spin mr-2"}),"Loading categories..."]})}):y.length>0?y.map(r=>e.jsx(b,{value:r.id,children:r.name},r.id)):e.jsx(b,{value:"no-categories",disabled:!0,children:"No categories available"})})]}),e.jsx(p,{})]})}),e.jsx(d,{control:n.control,name:"name",disabled:i,render:({field:t})=>e.jsxs(m,{children:[e.jsx(u,{children:"Product name"}),e.jsx(x,{children:e.jsx(g,{...t,type:"text",placeholder:"Product name",required:!0})}),e.jsx(p,{})]})}),e.jsx(d,{control:n.control,name:"description",disabled:i,render:({field:t})=>e.jsxs(m,{children:[e.jsx(u,{children:"Product description"}),e.jsx(x,{children:e.jsx(g,{...t,type:"text",placeholder:"Product description",required:!0})}),e.jsx(p,{})]})}),e.jsx(d,{control:n.control,name:"price",disabled:i,render:({field:t})=>e.jsxs(m,{children:[e.jsx(u,{children:"Product price"}),e.jsx(x,{children:e.jsx(g,{value:t.value,type:"number",placeholder:"0.00",step:"0.01",min:"0",onChange:r=>t.onChange(parseFloat(r.target.value)),required:!0})}),e.jsx(p,{})]})}),e.jsx(d,{control:n.control,name:"img",disabled:i,render:({field:{value:t,onChange:r,...q}})=>e.jsxs(m,{children:[e.jsx(u,{children:"Product Image"}),e.jsx(x,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(g,{type:"file",accept:"image/*",onChange:B=>{var F;const f=(F=B.target.files)==null?void 0:F[0];f&&(r(f),a&&a!==s.imageUrl&&URL.revokeObjectURL(a),E(URL.createObjectURL(f)))},...q}),e.jsx("div",{className:"mt-2",children:a?e.jsx("img",{src:a,alt:"Product preview",className:"max-w-[200px] rounded-lg border"}):e.jsx("div",{className:"text-sm text-gray-500",children:"No image preview available"})}),e.jsx("div",{className:"text-sm text-gray-500",children:t instanceof File?"New image selected":"Leave empty to keep current image"})]})}),e.jsx(p,{})]})}),e.jsx(G,{message:U}),e.jsx(H,{message:I}),e.jsxs("div",{className:"flex justify-between gap-4",children:[e.jsx(w,{type:"button",variant:"outline",onClick:()=>N({to:"/admin/products"}),disabled:i,children:"Cancel"}),e.jsx(w,{disabled:i,type:"submit",children:i?e.jsxs("div",{className:"flex items-center",children:[e.jsx(P,{className:"h-4 w-4 animate-spin mr-2"}),"Updating..."]}):"Update Product"})]})]})})]})}):e.jsx("div",{children:"Product not found"})};export{ge as component};
