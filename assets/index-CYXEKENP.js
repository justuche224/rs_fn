import{u as G,r as a,j as e,B as l,aA as M,t as c,aE as J,aF as K,aG as V}from"./index-BJX2Zmj2.js";import{B as W}from"./badge-0fc4Jg_Z.js";import{D as X,a as Y,b as Z,c as _,d as ee,e as se}from"./dialog-9inh1Fj1.js";import{T as ae,a as te,b as w,c as n,d as re,e as i}from"./table-QMatzzfJ.js";import{I as F}from"./input-BxfUgAF-.js";import{T as L,C as P}from"./checkbox-C7vmAcWi.js";import{A as ie,a as le,b as ne,c as oe,d as ce,e as de,f as me,g as he}from"./alert-dialog-x71Zjlxb.js";import{S as ge}from"./search-MXxF8nlS.js";import{P as ue}from"./plus-DODoxnIz.js";import{L as S}from"./loader-circle-BElWicZR.js";import{S as xe}from"./square-pen-DGsvME-g.js";import"./index-DAp99Zoo.js";import"./check-Ba8eI0ai.js";function je(){const b=G(),[p,O]=a.useState([]),[d,f]=a.useState([]),[C,D]=a.useState(!0),[m,B]=a.useState(""),[t,o]=a.useState(new Set),[N,v]=a.useState(null),[H,g]=a.useState(!1),[R,u]=a.useState(!1),[h,A]=a.useState(!1),[y,k]=a.useState(!1),[x,E]=a.useState(""),j=async()=>{try{D(!0);const s=await M();O(s),f(s)}catch{c.error("Failed to fetch categories")}finally{D(!1)}};a.useEffect(()=>{j()},[]),a.useEffect(()=>{if(m.trim()==="")f(p);else{const s=m.toLowerCase();f(p.filter(r=>{var z;return((z=r.name)==null?void 0:z.toLowerCase().includes(s))||r.id.toLowerCase().includes(s)}))}},[m,p]);const I=async s=>{try{const r=await J(s);v(r),E(r.name),g(!0)}catch{c.error("Failed to fetch category details")}},$=async()=>{if(!(!N||!x.trim()))try{k(!0),await K(N.id,x),c.success("Category updated successfully"),j(),g(!1)}catch{c.error("Failed to update category")}finally{k(!1)}},q=async()=>{if(t.size!==0)try{A(!0),await V(Array.from(t)),c.success(`Successfully deleted ${t.size} category(ies)`),o(new Set),j()}catch{c.error("Failed to delete categories")}finally{A(!1),u(!1)}},Q=s=>{const r=new Set(t);r.has(s)?r.delete(s):r.add(s),o(r)},U=()=>{t.size===d.length?o(new Set):o(new Set(d.map(s=>s.id)))},T=s=>new Date(s).toLocaleString();return e.jsxs("div",{className:"container mx-auto py-6 md:w-[90%] lg:w-[85%] px-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Category Management"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ge,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(F,{type:"text",placeholder:"Search categories...",className:"pl-8 pr-4",value:m,onChange:s=>B(s.target.value)})]}),e.jsxs(l,{onClick:()=>b({to:"/admin/categories/new"}),className:"cursor-pointer",children:[e.jsx(ue,{className:"h-4 w-4 mr-1"}),"New Category"]}),e.jsx(l,{onClick:j,disabled:C,className:"cursor-pointer",children:C?"Loading...":"Refresh"}),t.size>0&&e.jsxs(l,{variant:"destructive",onClick:()=>u(!0),className:"cursor-pointer",disabled:h,children:[e.jsx(L,{className:"h-4 w-4 mr-1"}),"Delete (",t.size,")"]})]})]}),C?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(S,{className:"animate-spin",size:40})}):e.jsx("div",{className:"bg-sidebar rounded-lg shadow overflow-hidden",children:e.jsxs(ae,{children:[e.jsx(te,{children:e.jsxs(w,{children:[e.jsx(n,{className:"w-12",children:e.jsx(P,{checked:t.size>0&&t.size===d.length,onCheckedChange:U,className:"cursor-pointer","aria-label":"Select all categories"})}),e.jsx(n,{children:"ID"}),e.jsx(n,{children:"Name"}),e.jsx(n,{children:"Products"}),e.jsx(n,{children:"Created"}),e.jsx(n,{children:"Updated"}),e.jsx(n,{className:"text-right",children:"Actions"})]})}),e.jsx(re,{children:d.length===0?e.jsx(w,{children:e.jsx(i,{colSpan:7,className:"text-center py-8",children:m?"No categories found matching your search":"No categories found"})}):d.map(s=>e.jsxs(w,{children:[e.jsx(i,{children:e.jsx(P,{checked:t.has(s.id),onCheckedChange:()=>Q(s.id),className:"cursor-pointer","aria-label":`Select ${s.name||"category"}`})}),e.jsxs(i,{className:"font-mono text-sm",children:[s.id.substring(0,8),"..."]}),e.jsx(i,{className:"font-medium",children:s.name}),e.jsxs(i,{children:[" ",e.jsxs(W,{variant:"outline",className:"bg-blue-100 text-blue-800",children:[s.productsCount," Products"]})]}),e.jsx(i,{children:T(s.createdAt)}),e.jsx(i,{children:T(s.updatedAt)}),e.jsx(i,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsxs(l,{className:"cursor-pointer",variant:"outline",size:"sm",onClick:()=>I(s.id),children:[e.jsx(xe,{className:"h-4 w-4 mr-1"}),"Edit"]}),e.jsxs(l,{variant:"destructive",size:"sm",className:"cursor-pointer",onClick:()=>{o(new Set([s.id])),u(!0)},children:[e.jsx(L,{className:"h-4 w-4 mr-1"}),"Delete"]})]})})]},s.id))})]})}),e.jsx(X,{open:H,onOpenChange:s=>{g(s),s||v(null)},children:e.jsxs(Y,{className:"max-w-md",children:[e.jsxs(Z,{children:[e.jsx(_,{children:"Edit Category"}),e.jsx(ee,{children:"Update the category name below."})]}),N&&e.jsx("div",{className:"grid gap-4 py-4",children:e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{htmlFor:"categoryName",className:"text-sm font-medium",children:"Category Name"}),e.jsx(F,{id:"categoryName",value:x,onChange:s=>E(s.target.value),className:"col-span-3"})]})}),e.jsxs(se,{children:[e.jsx(l,{variant:"outline",onClick:()=>g(!1),className:"cursor-pointer",disabled:y,children:"Cancel"}),e.jsx(l,{onClick:$,className:"cursor-pointer",disabled:y||!x.trim(),children:y?e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving..."]}):"Save Changes"})]})]})}),e.jsx(ie,{open:R,onOpenChange:s=>{u(s),!s&&!h&&o(new Set)},children:e.jsxs(le,{children:[e.jsxs(ne,{children:[e.jsx(oe,{children:"Confirm Category Deletion"}),e.jsx(ce,{children:t.size>1?`Are you sure you want to delete ${t.size} categories? This action cannot be undone and will remove all products in these categories.`:"Are you sure you want to delete this category? This action cannot be undone and will remove all products in this category."})]}),e.jsxs(de,{children:[e.jsx(me,{disabled:h,children:"Cancel"}),e.jsx(he,{onClick:s=>{s.preventDefault(),q()},disabled:h,className:"bg-red-600 text-white hover:bg-red-700",children:h?e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"mr-2 h-4 w-4 animate-spin"}),"Deleting..."]}):"Delete"})]})]})})]})}const Te=function(){return e.jsx(je,{})};export{Te as component};
